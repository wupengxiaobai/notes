# 微信小程序

### 基本应用

**微信小程序(应用)**

- 结构 wxml

  - 遵循XML语法
  - 常用标签
    - <view> 类似 <div>
    - <text> 类似 <span>
    - <image> 类似 <img>
      - 图片在开发小程序项目的时候
        - 图片需要设置宽高(有默认宽高)
        - 图片需要设置缩放模式 mode='aspectFill'
    - <navigator> 类似 <a>
  - 常用组件 
    - swiper

- 样式 wxss

  - 尺寸单位	rpx (基于750分辨率自动计算)
  - 样式导入 `import "xxx.wxss"`

- 行为 js 

  - ECMAScript

  - wx对象(微信小程序封装的顶级对象)

    注意: 微信小程序里面没有 DOM 和 BOM 的概念

- 配置 json

  - 非常严格的 json 格式

  - **app.json 全局配置**

    - pages 配置路由

    - window 配置头部
    - tabBar 底部选项卡

**组件组成基本**

![1543578741889](.\wx\1543578741889.png)

#### wxml 高级

**数据绑定  `{{}}`**

```html
<!-- wxml -->
<view>{{message}}</view>
```

```js
//	page.js
Page({
    data: {
        message: "Hello wx!"
    }
})
```

**特别注意: **

1. 花括号和引号之间不能有空格
2. 不要直接写 checked="false", 其计算结果是一个字符串, 转成 boolean 类型后代表真值, 需要使用插值表达式来进行判断

```xml
<checkbox checked="{{false}}"></checkbox>
```

**列表渲染 wx:for='{{}}'**

```xml
<!-- wxml --> 
<view wx:for="{{array}}" wx:key="{{item.id}}">{{item}}</view>
```

```js
//	page.js
Page({
    data: {
        array: [1, 2, 3, 4, 520]
    }
})
```

**注意: 如果是多层嵌套情况, 使用  wx:for-item='xxx' 指定被遍历的每个item**

**流程判断 wx:if='{{}}'**

```xml
<!-- wxml --> 
<view wx:if="{{array}}">if</view>
<view wx:else="{{array}}">else</view>
```

**流程判断2 hidden="{{}}"**

**xml 中书写 js 代码**

```xml
<!-- wxml -->
<wxs module='foo'>
    //	这里可导出一个对象, 这个对象可以直接在界面上使用
    module.exports = {
            sum: function(a, b){
            return a + b;
        }
    }
</wxs>
<view>{{foo.sum(1,2)}}</view>
```

#### wxss 常用

```css
/* 箭头 */
.jiantou::after {
  content: '';
  position: absolute;
  top: 50%;
  right: 50rpx;
  width: 14.5rpx;
  height: 14.5rpx;
  transform: rotate(45deg) translateY(-50%);
  border: 1px solid #333;
  border-left-width: 0;
  border-bottom-width: 0;
}

/*单行省略*/
.text-over {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}


/* 透明下边框 */
.no-bt {
  border-color: transparent !important;
}
```



#### 行为 js 文件

```js
/*
	此处可以是用来模块的引入和函数的封装
*/

Page({
    /**
   * 页面的初始数据
   */
    data: {},
    /**
   * 生命周期函数--监听页面加载
   */
    onLoad: function (options) {
        //	options.scene 可以识别用户通过什么方式进入我们的小程序
        //	我们需要请求过的数据, 在该生命周期进行请求相对合适
        //	使用 wx.require() 请求数据
        wx.request({
            url: 'https://locally.uieee.com/slides',
            data: '',
            header: {},
            method: 'GET',
            dataType: 'json',
            success: function(res) {},
            fail: function(res) {},
            complete: function(res) {},
        });
    },
    /**
   * 生命周期函数--监听页面初次渲染完成
   */
    onReady: function () {},
    /**
   * 生命周期函数--监听页面显示
   */
    onShow: function () {},
    /**
   * 生命周期函数--监听页面隐藏
   */
    onHide: function () {},
    /**
   * 生命周期函数--监听页面卸载
   */
    onUnload: function () {},
    /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
    onPullDownRefresh: function () {},
    /**
   * 页面上拉触底事件的处理函数
   */
    onReachBottom: function () {},
    /**
   * 用户点击右上角分享
   */
    onShareAppMessage: function () {}
})
```

##### **事件绑定和冒泡**

1. 冒泡事件 bind 事件类型 如 `bindtap` `bindlongpress`
2. 非冒泡事件 catch 事件类型 如 `catchtap` `catchlongpress`

**常用事件类型**

| 类型      | 触发条件                     |
| --------- | ---------------------------- |
| tap       | 手指触摸后马上离开           |
| longpress | 手指触摸后, 超过 350ms再离开 |



### 常用组件

#### 视图容器

##### View

|                        | 类型    | 默认值 | 说明                                                         |
| ---------------------- | ------- | ------ | ------------------------------------------------------------ |
| hover-class            | String  | none   | 指定按下(view)去的样式类, 当hover-class="none"时,没有点击效果 |
| hover-stop-propagation | Boolean | flase  | 指定是否组织本节点的祖先节点出现点击状态                     |
| hover-start-time       | Number  | 50     | 按住后多久出现点击状态, 单位毫秒                             |
| hover-stay-time        | Number  | 400    | 手指松开后点击状态保留时间, 单位毫秒                         |

##### scroll-view

| 属性              | 类型          | 默认值 | 说明                                                         |
| ----------------- | ------------- | ------ | ------------------------------------------------------------ |
| scroll-x/scroll-y | Boolean       | false  | 允许 横向/纵向 滚动                                          |
| upper-threshold   | Number/String | 50     | 设置距离顶部/左边多远时 触发 scrolltoupper 事件              |
| lower-threshold   | Number/String | 50     | 设置距离底部/右边多远时 触发 scrolltolower 事件              |
| bindscrolltoupper | EventHandle   |        | 滚动到顶部/左边, 会触发 scrolltoupper事件                    |
| bindscrolltolower | EventHandle   |        | 滚动到底部/右边, 会触发 scrolltlower                         |
| bindscroll        | EventHandle   |        | 滚动触发, event.detail={scrollLeft,scrollTop,scrollHeight,scrollWdith,deltaX,deltaY} |

![1544002774295](.\wx\1544002774295.png)

#### 基础内容

##### icon图标

| 属性名 | 类型          | 默认值 | 说明                                                         |
| ------ | ------------- | ------ | ------------------------------------------------------------ |
| type   | String        |        | icon的类型, 有效值: success, success_no_circle, info, warn, waiting, cancel, download, search, clear |
| size   | Number/String | 23px   | icon大小                                                     |
| color  | Color         |        | icon的颜色, 同css的color                                     |

##### text 组件

| 属性名     | 类型    | 默认值 | 说明                                                         |
| ---------- | ------- | ------ | ------------------------------------------------------------ |
| selectable | Boolean | false  | 文本是否可选                                                 |
| space      | String  | false  | 显示连续空格 有效值: ensp(中文字符空格一般大小),nbsp(根据字体设置的空格带小), emsp(中文字符空格大小) |
| decode     | Boolean | false  | 是否解码                                                     |

##### progress 进度条

| 属性            | 类型        | 默认值    | 说明                                                  |
| --------------- | ----------- | --------- | ----------------------------------------------------- |
| percent         | Float       |           | 百分比0~100                                           |
| show-info       | Boolean     | false     | 进度条右侧显示百分比                                  |
| border-radius   | Number      | 0         | 圆角大小                                              |
| font-size       | Number      | 16        | 右侧百分比字体大小                                    |
| stroke-width    | Number      | 6         | 进度条线的宽度                                        |
| color           | Color       | #09bb7    | 进度条颜色(请使用 activeColor)                        |
| activeColor     | Color       |           | 已选择的进度条的颜色                                  |
| backgroundColor | Color       |           | 未选择的进度条颜色                                    |
| active          | Boolean     | false     | 进度条从左往右的动画                                  |
| active-mode     | String      | backwards | backwards:动画从头播; forwards:动画从上次结束点接着播 |
| bindactiveend   | EventHandle |           | 动画完成事件                                          |

**注意: 在 mpVue 中使用进度条外包一个div**, 控制大小

#### 表单组件

```xml
<!--常用表单-->
<input type='text'>常用表单</input>

<!--复选框/组-->
<checkbox>复选框</checkbox>
<checkbox-group bindchange="checkboxHandler" data-参数名='参数值'>
    <!--给checkbox组添加修改事件, 并使用 data-参数名='参数值' 进行参数传递 -->
    <checkbox checked>撸码</checkbox>
    <checkbox>做菜</checkbox>
</checkbox-group>

<!--单选框/组-->
<radio>单选框</radio>
<radio-group>
    <radio checked value='male'>男</radio>
    <radio value='female'>女</radio>
    <radio disabled>保密</radio>
</radio-group>

<switch checked></switch>
```

**input的一些属性**

| 属性                                 | 类型        | 默认值 | 说明                                                         |
| ------------------------------------ | ----------- | ------ | ------------------------------------------------------------ |
| type                                 | String      | text   | 有效值: text/number/idcart/digit                             |
| password                             | Boolean     | false  | 是否为密码类型                                               |
| placeholder/placeholder-style(class) | String      |        | 输入款为空时占位符/占位符样式(样式类)                        |
| focus                                | Boolean     | false  | 自动焦点                                                     |
| auto-focus                           | Boolean     | false  | (讲讲废弃, 直接使用 focus) 自动聚焦, 拉起键盘                |
| bindinput                            | EventHandle |        | 键盘输入时触发 event.detail = {value, cursor, keyCode}，keyCode 为键值 |
| bindFocus                            | EventHandle |        | 输入框聚焦时触发                                             |
| bindblur                             | EventHandle |        | 输入款失去焦点时触发                                         |
| bindconfirm                          | EventHandle |        | 点击完成按钮时触发                                           |

```js
//	事件接收参数
checkboxHandler(e){
	console.log(e.detail);	//	获取表单值
    console.log(e.target.dataset['参数名']);	//	获取传递参数值
}
```

**mpVue中复选等**

![1544110339097](.\wx\1544110339097.png)

##### picker

支持五种选择器，通过mode来区分，分别是普通选择器，多列选择器，时间选择器，日期选择器，省市区选择器，默认是普通选择器。

**普通选择器: mode = selector**

| 属性名     | 类型               | 默认值 | 说明                                                         |
| ---------- | ------------------ | ------ | ------------------------------------------------------------ |
| range      | Array/Object Array | []     | mode 为 selector 或 multiSelector时, range 有效              |
| range-key  | String             |        | 当 range 是一个 Object Array 时, 通过 range-key 来选择器默认显示内容 |
| value      | Number             | 0      | 默认选择 range 中的第几个(下标0开始)                         |
| disabled   | Boolean            | false  | 是否禁用                                                     |
| bindchange | EventHandle        |        | value 改变时触发 change 事件, 通过 event.mp.detail.value/event.target/value 获取选择项对应索引 |
| bindcancel | EventHandle        |        | 取消选择或点遮罩层收齐 picker 时触发                         |

**多列选择器 mode = multiSelector**

| 属性名           | 类型                  | 默认值 | 说明                                                         |
| ---------------- | --------------------- | ------ | ------------------------------------------------------------ |
| range            | 二维数组/二维对象数组 | []     | 数组的每项表示每列的数据如[['a','b'],['c','d']]              |
| range-key        | String                |        | 当 range 是二维 Object Array时, 通过 range-key 来指定 Object 中 key 的值作为选择器显示内容 |
| value            | Array                 | []     | 每一项表示选择了 range 对应项中的第几个                      |
| bindchange       | EventHandle           |        | value 改变触发 cahnge 事件                                   |
| bindcolumnchange | EventHandle           |        | 某一列的值改变时触发 columnchange 事件                       |
| bindcancel       | EventHandle           |        | 取消选择时触发                                               |

**时间选择器: model = time**

**日期选择器: mode = date**

**省市区选择器: model=region**

注意: 在修改显示内容的时候要修改整个数组(使用setData)才能达到界面数据同时更新的效果

##### button

[参考](https://developers.weixin.qq.com/miniprogram/dev/component/button.html)

| 属性      | 类型    | 默认值  | 说明                                                   |
| --------- | ------- | ------- | ------------------------------------------------------ |
| type      | String  | default | default/primary/warn 只有defalut时才可以设置背景的颜色 |
| plain     | Boolean | false   | 按钮是否镂空, 背景色透明                               |
| loading   | Boolean | false   | 文字前是否带 loading 图标                              |
| open-type | String  |         | 微信开放能力(转发)                                     |
| disabled  | Boolean | false   | 是否禁止选中                                           |



#### swiper组件

```html
<swiper indicator-dots="{{indicatorDots}}"
  autoplay="{{autoplay}}" interval="{{interval}}" duration="{{duration}}">
  <block wx:for="{{imgUrls}}">
    <swiper-item>
      <image src="{{item}}" class="slide-image" width="355" height="150"/>
    </swiper-item>
  </block>
</swiper>
<button bindtap="changeIndicatorDots"> indicator-dots </button>
<button bindtap="changeAutoplay"> autoplay </button>
<slider bindchange="intervalChange" show-value min="500" max="2000"/> interval
<slider bindchange="durationChange" show-value min="1000" max="10000"/> duration
```



#### tabBar组件

属性说明: 

| 属性            | 类型     | 是否必填 | 默认值 | 描述                            |
| --------------- | -------- | -------- | ------ | ------------------------------- |
| color           | HexColor | 是       |        | tab 上的文字默认颜色            |
| selectedColor   | HexColor | 是       |        | tab上的文字选中时颜色           |
| backgroundColor | HexColor | 是       |        | tab 的背景色                    |
| borderStyle     | String   | 否       | black  | tabber上边款的颜色(black/white) |
| list            | Array    | 是       |        | tab的列表, 至少2个, 最多5个     |
| position        | String   | 否       | bootom | 可选值 bottom, top(无图标)      |

其中 list 接受一个数组, 数组中的每个项都是一个对象, 属性值如下

| 属性             | 类型   | 是否必填 | 说明                                                         |
| ---------------- | ------ | -------- | ------------------------------------------------------------ |
| pagePath         | String | 是       | 页面路径, 必须在pages中先定义                                |
| text             | String | 是       | tab上按钮文字                                                |
| iconPath         | String | 否       | 图片路径, icon 大小限制为40kb, 建议尺寸81px*81px(position 为 top时,该参数无效) |
| selectedIconPath | String | 否       | 选中时图片路径, 其它说明如上iconPath相同                     |



### 常用 API

#### 本地存储

- **设置本地存储** 

  - 同步设置 **`wx.setStorageSync(string key, Object data)`**

  - 异步设置 **`wx.setStorage(Object object)`**

    ```js
        wx.setStorage({
            key:"key",
            data:"value"
        })
    
        try {
            wx.setStorageSync('key', 'value')
        } catch (e) {}
    ```

- **获取本地存储** 

  - 异步获取 **`wx.getStorage(Object object)`** 

  - 同步获取 **`wx.getStorageSync(String)`**

    ```js
    wx.getStorage({
        key: 'key',
        success (res) {
            console.log(res.data)
        }
    })
    ```

#### 用户授权

**获取用户信息**

- **wx.getUserInfo()** 获取用户信息(调用前需要用户授权)

- 用户授权使用 button 组件 `<button open-type="getUserInfo" bindgetuserinfo="onGotUserInfo">获取用户信息</button>`

  mpVue 中授权演示如下: 

  ```html
  <button open-type="getUserInfo" @getuserinfo="handleGetUserInfo">授权登录</button>
  ```

  ```js
  handleGetUserInfo() {
      let _this = this;
      wx.getUserInfo({
          success(data) {	//	授权成功
              if (data.rawData) {
                  _this.isShow = true;
                  _this.userInfo = data.userInfo;
              }
          },
          fail(data) {	//	授权失败
              wx.showToast(
                  {
                      title: "授权失败",
                      icon: "none"
                  },
                  1500
              );
              _this.isShow = false;
          }
      });
  }
  ```

#### 加载动画

**头部加载动画**

- **wx.showNavigationBarLoading(Object object)** 开始

- **wx.hideNavigationBarLoading(Object object)** 关闭

**提示框加载动画**

- **wx.showLoading(Object object)**	开启
- **wx.hideLoading(Object object)**     关闭

**提示框**

- **wx.showToast(Object object)** 
- **wx.hideToast(Object object)**

#### **下拉事件监听**

- **wx.startPullDownRefresh(Object object)** 开启(或者 window 配置 enablePullDownRefresh 为true即可)
- **wx.stopPullDownRefresh(Object object)** 关闭

#### 媒体相关

#### 背景音乐

- 音乐播放 **`wx.playBackgroundAudio(Object object)`**
- 音乐暂停 **`wx.pauseBackgroundAudio(Object object)`**

**音乐播放/暂停监听**

- 监听音乐播放 **`wx.onBackgroundAudioPlay(function callback)`**
- 监听音乐暂停 **`wx.onBackgroundAudioPause(function callback)`**
- 监听音乐停止 **`wx.onBackgroundAudioStop(function callback)`**

#### 显示操作菜单

- **wx.showActionSheet(Object object)**

| 属性      | 类型     | 默认值 | 描述                            |
| --------- | -------- | ------ | ------------------------------- |
| itemList  | Array    |        | 按钮的文字数组, 数组长度最大为6 |
| success   | function |        | 接口调用成功的回调函数          |
| fail      | function |        | 接口调用失败的回调函数          |
| itemColor | string   |        | 按钮文字颜色                    |

**object.success** 参数

| 属性     | 类型   | 说明                                  |
| -------- | ------ | ------------------------------------- |
| tapIndex | number | 用户点击的按钮序号, 从上到下, 从0开始 |

```js
wx.showActionSheet({
    itemList: ['A', 'B', 'C'],
    success (res) {
        console.log(res.tapIndex)
    },
    fail (res) {
        console.log(res.errMsg)
    }
})
```

#### 上传/下载

**下载** 

`wx.downloadFile(Object object)`

| 属性     | 类型     | 说明                                        |
| -------- | -------- | ------------------------------------------- |
| url      | string   | 下载资源的url(必填)                         |
| header   | Object   | HTTP请求的 Header, Header中不能设置 Referer |
| filePath | string   | 指定文件下载后存储的路径                    |
| success  | function | 成功回调                                    |
| fail     | function | 失败回调                                    |

**object.success 回调函数参数**

| tempFilePath | 临时文件路径, 如果没有传入filePatch 指定临时文件, 则下载后的文件会存储到一个临时文件 |
| ------------ | ------------------------------------------------------------ |
| statusCode   | 开发者服务区返回的 HTTP 状态码                               |

**返回值**

`DownloadTask`	 一个可以监听下载进度变化的事件

**上传相关**

**chooseImage** 接口获取到一个本地资源的临时文件路径后, 可以通过此接口将本地资源上传到指定服务器.

| count      | number   | 9                          | 最多可以选择的图片张数             |
| ---------- | -------- | -------------------------- | ---------------------------------- |
| sizeType   | Array    | ['original', 'compressed'] | 所选图片尺寸(原图/压缩图)          |
| sourceType | Array    | ['album', 'camera']        | 所选图片来源(从相册选图, 使用相机) |
| success    | function |                            | 成功回调                           |

success 回调参数

| tempFilePaths | Array | 图片的本地临时文件路径列表 |
| ------------- | ----- | -------------------------- |
| tempFiles     | Array | 图片的本地临时文件列表     |



**uploadFile(Object)** 文件上传 将本地资源上传到开发者服务器,. 客户端发起一个 HTTPS POST请求, 其中 content-type为 multipart/form-data

| url      | String   | 必须 | 开发者服务器url                                              |
| -------- | -------- | ---- | ------------------------------------------------------------ |
| filePath | String   | 必须 | 要上传你文件资源的路径                                       |
| name     | String   | 必须 | 文件对应的 key, 开发者在服务器端通过key可以获取到文件的二进制内容 |
| header   | Object   |      | HTTP 请求 Header, header 中不能设置 Refere                   |
| success  | Function |      | 接口调用成功的回调函数                                       |

```js
wx.chooseImage({
    count: 9,
    sizeType: ["original", "compressed"], //  尺寸
    sourceType: ["album", "camera"], //  来源
    success: res => {
        let [tempFilePaths, tempFiles] = [res.tempFilePaths, res.tempFiles];
        this.uploadImageArr = this.uploadImageArr.concat(tempFilePaths);	
        //  tempFilePaths 就是本地存储图片的临时路径, 此处做保存, 用于方便遍历显示到界面上

        //  执行上传值服务端
        /* const uploadTask = wx.uploadFile({
            url: "http://example.weixin.qq.com/upload", // 仅为示例，非真实的接口地址
            filePath: tempFilePaths[0],
            name: "file",
            formData: {
              user: "test"
            },
            success(res) {
              const data = res.data;	//	服务器返回的数据
              const statusCode = res.statusCode	//	服务器返回http状态码
              // do something
            }
          });
          uploadTask.onProgressUpdate(res => {
            console.log("上传进度", res.progress);
            console.log("已经上传的数据长度", res.totalBytesSent);
            console.log(
              "预期需要上传的数据总长度",
              res.totalBytesExpectedToSend
            );
          }); */
    },
    fail() {}
});
```

### 常用封装

#### js的封装

**请求的封装**

```js
//  请求封装
module.exports = function(url, method, data) {
  return new Promise((resolve, reject) => {
    wx.request({
      url: url,
      data: data,
      method: method,
      header: {
        "Content-Type": 'json'
      },
      dataType: 'json',
      success: resolve,
      fail: reject
    })
  })
}
```

#### css 封装

```css

```



# 小程序API*

## 基础

### wx.canIUse(string schema)

判断小程序的API, 回调,参数,组件等是否在当前版本可用

- `${API}.${method}.${param}.${options}` 或者 `${component}.${attribute}.${option}` 

  参数说明:  

  - ${API} 代表 API 名字

  - ${method} 代表调用方式, 有效值为 return, success, object, callback

  - $(param) 代表参数或者返回值
  - ${options} 代表参数的可选值

  - ${component} 代表组件名字

  - ${attribute} 代表组件熟悉

  - ${option} 代表组件熟悉的可选值

  示例  `wx.canIUse('showToast.object.image')`

###系统

##### wx.getSystemInfoSync

##### wx.getSystemInfo

获取客户端系统信息, 返回值如下

| brand/model              | string | 手机品牌/型号     |
| ------------------------ | ------ | ----------------- |
| pixelRatio               | number | 设备像素比        |
| screenWidth/screenHeight | number | 屏幕宽度/高度     |
| windowWidth/windowHeight | number | 可使用窗口宽/高度 |
| language                 | string | 微信设置的语言    |
| version                  | string | 微信版本号        |
| system                   | string | 操作系统版本      |
| platform                 | string | 客户端平台        |

### 更新

##### wx.getUpdateManager()

获取**全局唯一**的版本更新管理器，用于管理小程序更新

##### UpdateManager

用来管理更新, 可以通过 wx.getUpdateManager 接口获取实例

方法如下: 

 -	UpdateManager.applyUpdate() 强制小程序重启并使用新版本.  下载完成(onUpdateReady 回调) 调用
	-	UpdateManager.onCheckForUpdate(callback) 监听像微信后台请求检查更新结果事件. 小程序启动时自动检查更新, 无需主动调用
			UpdateManager.onUpdateReady(callback) 小程序下载成功后回调
		UpdateManager.onUpdateFailed(callback) 小程序更新失败回调

```js
//  更新唯一凭证
let updateManager = wx.getUpdateManager()
// 查看是否有新版本
updateManager.onCheckForUpdate((res) => {
    console.log(res.hasUpdate)
})
//  有新版本则自动触发
updateManager.onUpdateReady(() => {
    wx.showModel({
        title: '更新提示',
        content: '新版本已准备哈, 是否重启',
        success(res) {
            if (res.confirm) {
                //  强制小程序重启使用新版
                updateManager.applyUpdate()
            }
        }
    })
})
//  更新失败回调
updateManager.onUpdateFailed(function() {
    console.log('更新失败')
})
```

### 小程序

#### 生命周期 

###### wx.getLaunchOptionsSync

获取小程序启动时的参数, 返回值 Object(启动参数)

| path         | string | 启动小程序的路径                                             |
| ------------ | ------ | ------------------------------------------------------------ |
| scene        | number | 启动小程序的场景值(1020 公众号profile页相关小程序列表, 1035公招自定义菜单, 1036 App分享卡片, 1037小程序打开小程序, 1038 从另一个小程序返回, 1043 公众号模板消息) |
| query        | Object | 启动小程序的 query 参数                                      |
| shareTicket  | string |                                                              |
| referrerInfo | Object | 来源信息. 从另一个小程序, 公众号或 App进入小程序时返回. 否则为 {} (appId 来源的 appId; extraData 来源的小程序传来的数据, scene=1037/1038时支持) |

#### 应用级别事件

###### wx.offPageNotFound(callback)

取消监听小程序要打开的页面不存在事件

callback 打开的页面不存在事件的回调函数

###### wx.onPageNotFound(callback)

监听小程序要打开页面不存在事件

callback 小程序打开的页面不存在事件的回调函数

**注意: 我们可以在回调中使用页面重定向, 但是必须在回调中同步处理**

###### wx.offError(callback)

取消监听小程序错误事件, callback 错误事件的回调

###### wx.onError(callback)

监听小程序错误事件. 如脚本错误或 API 调用报错等. 改时间与 App.onError 的回调时机与参数一致

callback 回调函数, 参数 error 错误信息, 包含堆栈

###### wx.offAppShow(callback)

取消件套小程序切前台事件

###### wx.onAppShow(callback)

监听小程序切前台事件. 改时间与 App.onShow 回调参数一致

参数 res 结构

| path         | string | 小程序切前台的路径                                           |
| ------------ | ------ | ------------------------------------------------------------ |
| scene        | number | 小程序切前台的场景值                                         |
| query        | Object | 小程序切前台的query参数                                      |
| shareTicket  | string | 更多转发信息                                                 |
| referrerInfo | Object | 来源信息(appId 来源 的appId; extraData 来源传递来的数据. scene=1037/1038时支持) |

部分版本在无 referrerInfo 的时候会返回 undefined, 使用 `options.referrerInfo && options.referrerInfo.appId` 进行判断

###### wx.offAppHide(callback)

取消监听小程序切后台事件, 回调

###### wx.onAppHide(callback)

监听小程序切后台事件, 与 App.onHide 回调时机一致.

### 定时器

##### setTimeout(callback, number delay, any rest)

设定一个定时器, 在定时到期以后执行注册的回调函数

参数

​	callback  回调函数

​	number delay 延迟时间, 单位ms

​	any rest 附加参数, 作为参数传递给回调函数

返回值 number 定时器的编号, 该值传递给 clearTimeout 来取消定时器

##### clearTimeout(timeoutID)

取消由 setTimeout 设置的定时器

##### setInterval()

设定一个定时器, 按照指定的周期来执行注册回调

##### clearInterval()

取消由 setInterval 注册的定时器

### 调试

##### wx.setEnableDebug(Object object)

设置是否打开调试开. 

- enableDeBug 是否打开调试
- success 成功回调函数
- ...

##### wx.getLogManager(number level)

获取日志管理器对象.

- number level 取值 0/1, 取值为0表示会把 APP, Page 的生命周期函数和 wx命名空间下的函数调用写入入职, 取1则不会, 默认 0.

###### 返回值

LogManager 日志管理器实例

​	方法

 - LogManager.debug() 写 debug 日志
 - LogManager.info() 写 info 日志
 - LogManager.log() 写 log 日志
 - LogManager.warn() 写 warn 日志

使用说明 最多保存 5M 的日志内容, 超过旧内容会被删除.

用户可以通过使用 \<Button\> 组件的 open-type='feedback' 来上传打印的日志. 开发者可以通过小程序管理后台左侧菜单 "客服反馈" 页面查看

基础库默认把 App, Page 的生命周期函数和 wx 命名空间下的函数调用写入日志

#### 云开发控制台 console

云开发提供了一个控制台用于可视化管理云资源, 控制台包含以下几大模块

- 概览: 查看云资源的总体使用情况
- 用户管理: 查看小程序的用户访问记录
- 数据库: 管理数据库集合, 记录, 权限设置, 索引设置
- 存储管理: 管理云文件, 权限设置
- 云函数: 管理云函数, 查看调用日志. 监控记录
- 统计分析: 查看云资源详情使用统计

在用户管理中会显示使用云能力的小程序的访问用户列表, 默认以访问时间倒序排列, 访问时间的触发点是在小程序端调用 wx.cloud.init 方法, 其中 traceUser 参数值为 true  

```js
wx.cloud.init({
    traceUser: true
})
```



## 路由

#### wx.navigateBack(Object object)

- delta 回退多少步数, 超过步数则回到index
- success 成功回调

#### wx.navigateTo(Object object)

- url 跳转地址
- success 成功回调
- ...

#### wx.reLaunch(Object object)

关闭所有页面并指定跳转某页面

- url 指定跳转页面地址
- success 成功回调

#### wx.redirect(Object object)

关闭当前页面,并指定跳转某一页面

- url 跳转页面地址
- success 成功回调

#### wx.switchToTab(Object object)

指定跳转某一 tabBar 项

- url 指定跳转 tabBar 地址



## 界面

### 交互

##### wx.showLoading(Object object)

- title 加载提示
- mask 是否涵盖隐藏层, 默认false
- success 成功回调

##### wx.hideLoading() 加载

关闭加载loading

##### wx.showToast(Object object) 轻提示

- title 提示内容
- icon 提示体表
- mask 是否涵隐藏层

##### wx.hideToast() 隐藏轻提示

- success 成功回调
- ...

##### wx.showModel(Object object) 模态框

- title 标题
- content 内容
- cancelText 取消文本
- cancelColor 取消文本字体颜色
- confirmText 确认文本
- confirmColor 确认文本字体颜色
- success() 成功回调
  - 参数 res 根据res, 是可以确定点击了取消还是点击了确认

##### wx.showActionSheet(Object object)

显示操作菜单

- itemList 操作列表项
- success 成功回调 参数 res.tapIndex 选择菜单项索引

### 导航栏

##### wx.hideNavigationBarLoading(Object object)

当前页面隐藏导航条加载动画

- success 成功回调
- ...

##### wx.setNavigationBarColor(Object object)

设置页面顶部导航颜色

- fontColor 前景颜色值(按钮, 标题, 状态栏颜色, 支持 #ffffff, #000000)
- backgroundColor 背景颜色值, 有效值为十六进制颜色
- animation 动画效果
  - duration 动画变化时间, 默认0
  - timingFunc 动画变化方式, 默认 linear
    - linear easeIn easeOut easeInOut
- success 成功回调

##### wx.setNavigationBarTitle(Object object)

设置当前页面顶部导航标题

- title 标题文本
- success 成功回调
- ....

##### wx.showNavigationBarLoading()

在当前页面显示导航条加载动画

- success 成功回调

### 背景

##### wx.setBackgroundColor(Object object)

动态设置窗口的背景色

- backgroundColor 窗口的背景色, 必须是十六进制
- success 成功回调

##### wx.setBackgroundTextStyle(Object object)

动态设置下拉背景字体, loading 图的演示

- textStyle 必填 下拉背景字体, loading 样式
  - dark	
  - light

### Tab Bar

##### wx.hideTabBar(Object object)

隐藏 tabBar

- animation 是否需要动画效果, 默认false
- success 成功回调
- ...

##### wx.showTabBar(Object object)

显示 tabBar

- animation 是否需要动画效果, 默认false
- success 成功回调
- ...

##### wx.setTabBarStyle(Object object)

动态设置 tabBar 的整体样式

- color	tab文字默认颜色HexColor
- selectedColor      tab被选中时文字颜色HexColor
- backgroundColor     tab的背景色HexColor
- borderStyle   tabBar上边框的颜色, 支持 black/white
- success  成功回调
- ...

##### wx.setTabBarItem(Object object)

动态设置 tabBar 某一项的内容

- index tabBar 项目索引
- text    tab 上的按钮文字
- iconPtah  图片路径, 大小限制 40kb, 建议尺寸 81px*81px, 不支持网络图片
- selectedIconPath 选中时图片路径
- success  接口调用成功的回调函数
- ..

##### wx.showTabBarRedDot(Object object)

显示 tabBar 某一项的右上角的红点

- index 索引
- success 成功回调
- ....

##### wx.hideTabBarRedDot(Object object)

隐藏 tabBar 某一项右上角红点

- index 索引
- success 成功回调
- ....

##### wx.setTabBarBarBadge(Object object)

给 tabBar 某一项右上角添加文本

- index	索引	
- text        文本内容

##### wx.removeTabBarBadge(Object object)

移除 tabBar 某一项右上角的文本

- index 索引
- success 成功回调
- ...

### 下拉刷新

##### wx.startPullDownRefresh(Object object)

开始下拉刷新. 调用后出发下拉刷新动画, 效果与用户手动刷新一致

- success 成功回调

##### wx.stopPullDownRefresh()

停止当前页面下拉刷新

- success 成功回调

### 滚动

##### wx.pageScrollTo(Object object)

将页面滚动到目标位置

- scrollTop 滚动到页面的目标位置, 单位 px
- duration 滚动动画的时长, 单位 ms
- success 成功回调
- ...

### 动画

##### wx.createAnimation(Object object)

创建一个动画实例 animation. 调用实例的方法来描述动画, 最后通过动画实例的 export 方法导出动画数据传递给组件的 animation 属性

- duration 动画持续时间
- timingFunction 动画的效果, 默认 linear
- delay 延迟时间
- transformOrigin '50% 50% 0' 动画开始基点

###### 返回值  Animation

动画对象

- Animation.export() 导出动画队列

  export 方法每次调用后会清掉之前的动画操作

-  Animation.step() 表示一组动画完成.

  可以在一组动画中调用任意多个动画方法, 一组动画的所有动画会同时开始, 一组动画完成后才会进行下一组动画的开始.

#### 自定义组件

##### wx.nextTick(callback)

延迟一部分操作到下一个时间片再执行

#### 菜单

##### wx.getMenuButtonBoundingClientRect()

获取菜单按钮布置信息

#### 置顶

##### wx.setTopBarText(Object object)

动态设置置顶栏文字内容. 只有当前小程序被置顶时能生效.

- text 文本内容
- success 成功回调

### 窗口

##### wx.offWindowResize(callback)

取消监听窗口尺寸变化事件

- callback 尺寸变化事件回调

##### wx.onWindowResize(callback)

监听窗口尺寸变化

- callback 
  - 参数 res.size 
    -  windowWidth
    -  windowHeight

## 网络

### 发起请求

##### wx.request(Object object)

- url 开发者服务器地址
- data 请求参数
- header 设置请求头 默认 application/json
- method 请求方法 默认 get
  - OPTIONS HTTP 请求 OPTIONS
  - GET  HTTP请求GET
  - HEAD  HTTP请求 HEAD
  - POST HTTP 请求 POST
  - ... 
- dataType 返回数据格式
  - json 返回的数据为 JSON , 返回后会对数据进行一次 JOSN.parse
  - 其它  不对返回的内容进行 JSON.parse
- responseType 响应数据类型
  - text	响应的数据为文本
  - arraybuffer 响应的数据为 ArrayBuffer
- success 成功回调
  - data  开发者服务返回的数据
  - statusCode 开发者服务器返回的 HTTP 状态码
  - header 开发者服务器返回的 HTTP Response Header
- ...

data 参数说明

最终发送给服务器的数据是 String类型, 如果传入的data不是String, 会被转换, 规则如下:

- GET 方法的数据, 转成 query (q=xx&m=xxx&..)
- POST 方法且header['content-type']为 application/json 的数据, 会对数据进行 JSON 序列化
- POST 方法且 header['content-type'] 为 application/x-www-form-urlencoded 的数据, 会将数据转换成 query(encodeURIComponent(k)=encodeURIComponent(v)&encodeURIComponent(k)=encodeURIComponent(v)..)

示例代码

```js
let RequestTask = wx.request({
    url: 'test.php', // 仅为示例，并非真实的接口地址
    data: {
        x: '',
        y: ''
    },
    header: {
        'content-type': 'application/json' // 默认值
    },
    success(res) {
        console.log(res.data)
    }
})
```

返回值 RequestTask

- RequestTask.abort() 

  中断请求任务

- onHeadersReceived(callback)

  监听 HTTP Response Header 事件, 比请求完成事件更早

- offHeadersReceived(callback) 取消监听

### 下载

##### wx.downloadFile(Object object)

下载文件资源到本地. 客户端直接发起一个 HTTPS GET请求, 返回文件的本地临时路径

注意: 请在服务端响应的 header 中指定合理的 Content-Type 字段, 以保证客户端正确处理文件类型

- url 下载资源的URL路径
- header HTTP请求的 Header, Header中不能设置 Referer
- filePath 指定文件下载后存储的路径
- success 成功回调
  - tempFilePath  临时文件路径, 如果没有传入 filePath 指定文件存储路径, 则下载后的文件会存储到一个临时文件
  - statusCode 开发者服务器返回的 HTTP 状态码
- ....

###### 返回值 DownloadTask

一个可以监听下载进度变化事件和取消下载的对象

- DownloadTask.abort() 中断下载任务
- DownloadTask.onProgressUpdate(callback) 监听下载进度变化事件

		callback 返回值 res

		- progress 下载进度百分比
		
		- totalBytesWritten 已经下载的数据长度, 单位 bytes
		
		- totalBytesExpectedToWrite 预期需要下载的数据总长度, 单位 Bytes

```js
let DownloadTask = wx.downloadFile({
    url: 'https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1545303501290&di=fdd08c353d8c0c4c44afca807aa9a1d7&imgtype=0&src=http%3A%2F%2Fpic.58pic.com%2F00%2F95%2F76%2F78bOOOPIC49.jpg',
    success: (res) => {
        if (res.statusCode == 200) {
            console.log(res.tempFilePath)
            this.setData({
                'imgUrl': res.tempFilePath
            })
        }
    }
})
RequestTask.onProgressUpdate(function(res) {
    console.log(res)
})
```

- onHeadersReceived(callback)

监听 HTTP Response Header 事件. 比请求完成事件更早

参数 res.http 属性是开发者服务区返回的 HTTP Response Header

### 上传

##### wx.uploadFile(Object object)

将本地资源上传到服务器. 客户端发起一个 HTTPS POST 请求, 其中 content-type 为 multipart/form-data

- url	开发者服务区地址
- filePath 要上传文件资源路径
- name 文件对应的key, 开发者在的服务端可以通过 key 获取文件的二进制内容
- header HTTP 请求 Header
- formData HTTP 请求中其他额外的 form data
- success 成功回调
  - res.data 开发者服务区返回的数据
  - res.statusCode 开发者服务区返回的 HTTP 状态码
- ...

示例代码

```js
wx.chooseImage({
    success(res) {
        const tempFilePaths = res.tempFilePaths
        wx.uploadFile({
            url: 'https://example.weixin.qq.com/upload', // 仅为示例，非真实的接口地址
            filePath: tempFilePaths[0],
            name: 'file',
            formData: {
                user: 'test'
            },
            success(res) {
                const data = res.data
                // do something
                }
        })
    }
})
```

###### 返回值 UploadTask

UploadTask 一个可以监听上传进度的事件和取消上传的对象

- UploadTask.abort() 中断上传任务

- UploadTask.onProgressUpdate(callback)

  监听上传进度变化事件

- UploadTask.offProgressUpdate(callback)

  取消监听上传进度条变化事件
- UploadTask.onHeadersReceived(callback)

  监听 HTTP Response Header 事件, 比请求完成事件更早

```js
uploadTask.onProgressUpdate((res) => {
    console.log('上传进度', res.progress)
    console.log('已经上传的数据长度', res.totalBytesSent)
    console.log('预期需要上传的数据总长度', res.totalBytesExpectedToSend)
})

uploadTask.abort() // 取消上传任务
```

### WebSocket

##### wx.connectSocket(Object object)

创建一个 WebScoket 连接

- url  开发者服务器 wss 接口地址
- header 请求头设置
- protocols 子协议数组

- success 成功回调
- ...

###### 返回值 SocketTask

WebSocket 任务管理, 可以通过 wx.connectSocket() 接口创建返回

方法

- SocketTask.send(Object object) 通过 WebSocket 连接发送数据
- SocketTask.close(Object object) 关闭 WebSocket 连接
- SocketTask.onOpen(callback) 监听 WebSocket 连接打开事件
- SocketTask.onClose(callback) 监听 WebSocket 连接关闭事件
- SocketTask.onError(callback) 监听 WebSocket 错误事件
- SocketTask.onMessage(callback) 监听 WebSocket 接收到服务器的消息事件

##### wx.onSocketError(callback)

监听 WebSocket 错误事件

- callback WebSocket错误事件的回调

##### wx.onSocketMessage(callback)

监听 WebSocket 接受到服务器的消息事件

回调参数 res.data 服务器返回的消息

##### wx.onSocketClose(callback)

监听 WebSocket 连续关闭事件

- callback WebSocket 连续关闭事件的回调函数

##### wx.onSocketOpen(callback)

监听 WebSocket 连续打开事件

- callback 参数 res.header 连接成功的 HTTP 响应头

##### wx.sendSocketMessage(Object object)

通过 WebSocket 连接发送数据, 需要先 wx.connectSocket, 并在 wx.onSocketOpen 回调之后才能发送

- data   string/ArrayBuffer 需要发送的内容
- success 成功回调
- ...

```js
const socketOpen = false
const socketMsgQueue = []
wx.connectSocket({
    url: 'test.php'
})

wx.onSocketOpen(function (res) {
    socketOpen = true
    for (let i = 0; i < socketMsgQueue.length; i++) {
        sendSocketMessage(socketMsgQueue[i])
    }
    socketMsgQueue = []
})

function sendSocketMessage(msg) {
    if (socketOpen) {
        wx.sendSocketMessage({
            data: msg
        })
    } else {
        socketMsgQueue.push(msg)
    }
}
```

##### wx.closeSocket(Object object)

关闭 WebSocket 连接

- code	默认值1000(正常关闭连接)

- reason   可读字符串, 表示连接被关闭的原因. 字符串必须不长于123字节的 UTF-8文本
- success 成功回调
- ...

### mDns

##### wx.onLocalServiceResolveFail(callback)

监听 mDNS 服务解析失败的事件

- callback 回调

##### wx.onLocalServiceDiscoveryStop(callback)

监听 mDNS 服务停止搜索的事件

##### wx.onLocalServiceLost(callback)

监听 mDNS 服务离开的事件

- callback

  参数 res.serviceType	服务的类型

  参数 res.serviceName  服务的名称

##### wx.onLocalServiceFound(callback)

监听 mDNS 服务发现的事件

- callback

  参数 res.serviceType 服务的类型

  参数 res.serviceName 服务的名称

  参数 res.ip	服务的 ip 地址

  参数 res.port 服务的端口

## 数据缓存

##### wx.getStorageInfo(Object object)

异步获取当前 storage 的相关信息

- success 成功回调
  - keys 当前 storage 中所有的 key
  - currentSize 当前占用的空间大小
  - limitSize 限制的空间大小
- ...

##### wx.getStorageInfoSync()

是wx.getStorageInfo 同步版本

- keys  当前 storage 中所有的 key
- currentSize  当前占用的空间大小 KB
- limitSize  限制空间大小

实例代码

```js
wx.getStorageInfo({
    success(res) {
        console.log(res.keys)
        console.log(res.currentSize)
        console.log(res.limitSize)
    }
})

try {
    const res = wx.getStorageInfoSync()
    console.log(res.keys)
    console.log(res.currentSize)
    console.log(res.limitSize)
} catch (e) {
    // Do something when catch error
}
```

##### wx.clearStorage(Object object)

清理本地数据缓存

- success()
- ...

##### wx.clearStorageSync()

wx.clearStorage() 的同步版本

示例 

```js
wx.clearStorage()

try {
    wx.clearStorageSync()
} catch (e) {
    // Do something when catch error
}
```

##### wx.removeStorage(Object object)

从本地缓存中移除指定 key

- key 本地缓存中指定key
- success 成功回调

##### wx.removeStorageSync()

wx.removeStorage() 的同步版本

示例

```js
wx.removeStorage({
    key: 'key',
    success(res) {
        console.log(res.data)
    }
})

try {
    wx.removeStorageSync('key')
} catch (e) {
    // Do something when catch error
}
```

##### wx.setStorage(Object object)

将数据存储在本地缓存中指定的 key 中. 会覆盖原来 key 对应的内容. 数据存储生命周期跟小程序本身一致, 除非用户主动删除或查过一定时间被自动清理, 否则数据都一直可用. 单个 key 允许存储最大数据长度为 1MB, 所有数据存储上线为 10MB

- key 本地存储中指定的 key
- data 需要存储的内容, 支持原生类型, Date 及能通过 JSON.stringify 序列化的对象
- success 成功回调
- ...

##### wx.setStorageSync(key, data)

wx.setStorage() 的同步版本

```js
wx.setStorage({
    key: 'key',
    data: 'value'
})

try {
    wx.setStorageSync('key', 'value')
} catch (e) { }
```

##### wx.getStorage(Object object)

从本地缓存中异步获取指定 key 的内容

- key  本地缓存中的指定key
- success 读取成功回调
  - 参数 res.data     本地缓存指定 key 对应的内容

```js
wx.getStorage({
    key: 'key',
    success(res) {
        console.log(res.data)
    }
})

try {
    const value = wx.getStorageSync('key')
    if (value) {
        // Do something with return value
    }
} catch (e) {
    // Do something when catch error
}
```

## 媒体

### 地图

##### wx.createMapContext(mapId, this)

- mapId 		<map>组件的 id
- this                  在自定义组件下,当前组件示例的 this, 用来操作组件内 <map> 组件

###### 返回值 MapContext

MapContext 实例, 可以通过 wx.createMapContext 获取

mapContext 通过 id 跟一个 <map> 组件绑定, 操作对应 <map> 组件

方法

- MapContext.getCenterLocation(Object object)

  获取当前地图中心的经纬度, 返回 gcj02 坐标系, 可以用于 wx.opnLoaction()

  - success 成功回调
    - res.longitude 经度
    - res.latitude  纬度
  - ...

- MapContext.moveToLocation()

  将地图中心移动到当前定位点. 需要配合 map 组件的 show-loaction 使用

- MapContext.translateMarker(Object object)

  平移 Marker, 带动画

  - markerId 指定 marker
  - destination 指定移动目标点
    - longitude 经度
    - latitude  纬度
  - autoRotate 移动过程是否旋转
  - rotate 旋转角度
  - duration 动画持续时长
  - animationEnd 动画结束回调
  - success 成功回调

- MapContext.includePoints(Object object) 

  缩放视野展示所有经纬度

  - points 显示在可视区内坐标点列表
    - longitude 经度
    - latitude 纬度
  - success 成功回调
  - ..

- MapContext.getRegion()

  获取当前地图的视野范围

  - success 
    - res.southwest 西南角经纬度
    - res.northeast 东北角经纬度

- MapContext.getScale()

  获取地图的缩放级别

  - success 
    - res.scale 缩放值

### 图片

##### wx.compressImage()

压缩图片接口, 可选压缩质量

- src 图片路径(相对路径, 临时文件路径, 存储文件路径)
- quality 压缩质量 数值越小, 质量越低, 压缩率越高 (仅支持 jpg)
- success 成功回调

```js
wx.compressImage({
  src: '', // 图片路径
  quality: 80 // 压缩质量
})
```

##### wx.saveImageToPhotosAlbum(Object object)

调用钱需要 用户授权 scope.writePhotosAlbum

保存图片到系统相册

- filePath 图片文件路径
- success 成功回调

```js
wx.saceImageToPhotosAlbum({
    success(res){}
})
```

##### wx.getImageInfo(Object object)

获取图片信息, 网络图片需要先配置 download 域名才能生效

- src 图片路径
- success 成功回调
  - res.width 图片原始宽度
  - res.height 图片原始高度
  - res.path 图片的本地路径
  - res.orientation 拍照时设备方向
    - up 默认(手机横持拍照)
  - res.type 图片格式

##### wx.previewImage(Object object)

在新页面中全屏预览图片. 预览过程中用户可以进行保存, 发送给好友等操作

- urls  Array.<string>需要预览的图片链接列表, 必须
- current  urls的第一张 当前显示图片的链接
- success 成功回调

##### wx.chooseImage(Object object)

从本地相册选择图片或使用相机拍照

- count 最多可选择图片张数, 默认9
- sizeType 所选图片尺寸, 默认 ['original', 'compressed']
  - original
  - compressed
- sourceType 选择图片来源 ['album', 'camera']
  - album 从相册选图
  - camera 使用相机照相
- success 成功回调
  - 参数 res.tempFilePaths
  - 参数 res.tempFiles
    - 属性 path 本地临时文件路径
    - 属性 size 本地临时文件大小

示例 

```js
wx.chooseImage({
    count: 1,
    sizeType: ['original', 'compressed'],
    sourceType: ['album', 'camera'],
    success(res) {
        // tempFilePath可以作为img标签的src属性显示图片
        const tempFilePaths = res.tempFilePaths
        }
})
```

### 视频

##### wx.saveVideoToPhotosAlbum(Object object)

调用前需要 用户授权 scope.writePhotosAlbum

保存视频到系统相册

- filePath 视频文件路径
- success 成功回调
- ...

```js
wx.saveVideoToPhotosAlbum({
    filePath: 'wxfile://xxx',
    success(res) {
        console.log(res.errMsg)
    }
})
```

##### wx.chooseVideo(Object object)

拍摄视频或从手机相册选视频

- sourceType 视频选择的来源 默认 ['album', 'camera']
  - album 从相册中选择视频
  - camera 使用相机拍摄视频
- compressed 是否压缩所选择的视频文件
- maxDuration 拍摄视频最长时间. 单位 s
- camera 
  - back 启用后置摄像头
  - front 启用前置摄像头
- success 成功回调
  - tempFilePath 选定视频临时文件路径
  - duration  选定视频时间长度
  - size 选定数据量大小
  - height 选定视频的高度
  - width 选定视频宽度

```js
wx.chooseVideo({
    sourceType: ['album', 'camera'],
    maxDuration: 60,
    camera: 'back',
    success(res) {
        console.log(res.tempFilePath)
    }
})
```

##### wx.createVideoContext(id, this)

创建 video 上下文 VideoContext 对象

- id  <video> 组件的id
- this  当前组件实例的this, 以操作组件内 <video> 组件

###### 返回值

VideoContext

VideoContext 实例, 可以通过 wx.createVideoContext 获取

videoContent 通过 id he一个 <vidoe> 组件绑定, 操作对应的 <video> 组件

- VideoContext.play() 播放视频
- VideoContext.pause() 暂停视频
- VideoContext.stop() 跳转到指定位置
- VideoContext.seek(number position) 跳转指定位置
- VideoContext.sendDanmu(Object data) 发送弹幕
- VideoContext.playbackRate(number rate) 设置播放倍速
- VideoContext.requestFullScreen(Object object) 进入全屏
- VideoContext.exitFullScreen() 退出全屏
- VideoContext.showStatusBar() 显示状态栏(ios全屏下有效)
- VideoContext.hideStatusBar() 隐藏状态栏(ios有效)

### 音频

##### wx.stopVoice(Object object)

结束播放语音

- success 成功回调

##### wx.pauseVoice(Object object)

暂停正在播放的语音, 再次调用 wx.playVoice 播放同一个文件时, 会从暂停处开始播放, 如果想要从头开始播放, 需要先调用 wx.stopVoice

- success 成功回调

##### wx.playVoice(Object object)

开始播放语音. 同时只允许一个语音文件还没播放完

- filePath 需要播放的语音文件的文件路径
- duration 指定录音时长, 到达指定录音时长后自动停止录音
- success 成功回调

```js
wx.startRecord({
    success(res) {	//用户授权成功
        const tempFilePath = res.tempFilePath
        wx.playVoice({
            filePath: tempFilePath,
            complete() { }
        })
    }
})
```

##### wx.setInnerAudioOption(Object object)

设置 InnerAudioContext 的播放选项, 设置之后对当前小程序全局生效

- mixWithOther 是否与其他影片混播, 设置为 true 之后, 不会终止其他应用或微信内的音乐, 默认 true
- obeyMuteSwitch (ios生效) 是否遵循静音开关, 设置为false时, 即使在静音模式下, 也能播放声音. 默认 true
- success 成功回调

##### wx.getAvailableAudioSources(Object object)

获取当前支持的音频输入源

- success

  参数 res.audioSources Array.<string> 支持的音频输入源列表, 可在 [RecorderManager.start()](https://developers.weixin.qq.com/miniprogram/dev/api/RecorderManager.start.html) 接口中使用

  ​	合法值: auto 自动设置, 所有平台适用

##### wx.createInnerAudioContext()

创建内部 audio 上下文 InnerAudioContext 对象

###### 返回值 InnerAudioContext

- InnerAudioContext.onCanplay(callback) 监听音频进入可以播放状态的事件
- InnerAudioContext.offCanplay(callback) 取消监听音频进入可以播放状态的事件
- InnerAudioContext.onPlay(callback) 监听音频播放事件
- InnerAudioContext.offPlay(callback) 取消监听音频播放事件
- InnerAudioContext.onPause(callback) 监听音频暂停事件
- InnerAudioContext.offPause(callback) 取消监听音频播放事件
- InnerAudioContext.onStop(callback) 监听音频停止事件
- InnerAudioContext.offStop(callback) 取消监听音频停止事件
- InnerAudioContext.onEnded(callback) 监听音频自然播放至结束的事件
- InnerAudioContext.offEnded(callback) 取消监听音频自然播放到结束的事件
- InnerAudioContext.onTimeUpdate(callback) 监听音频播放进度更新事件
- InnerAudioContext.offTimeUpdate(callback) 取消监听音频播放进度更新事件
- InnerAudioContext.onError(callback) 监听音频播放错误事件
- InnerAudioContext.offError(callback) 取消监听音频播放错误事件
  - 回调参数 res.errCode
    - 10001 系统错误
    - 10002 网络错误
    - 10003 文件错误
    - 10004 格式错误
    - -1         未知错误
- InnerAudioContext.offError(callback) 取消监听音频播放错误事件
- InnerAudioContext.onWaiting(callback) 监听音频加载中事件, 音频因为数据不足, 需要停下来加载时触发
- InnerAudioContext.onSeeking(callback) 监听音频进行跳转操作事件
- InnerAudioContext.offSeeking(callback) 取消监听音频进行跳转操作的事件
- InnerAudioContext.onSeeked(callback) 监听音频完成跳转操作的事件
- InnerAudioContext.offSeeked(callback) 取消监听音频跳转完成事件
- InnerAudioContext.paly() 播放
- InnerAudioContext.pause() 暂停, 再次播放会从暂停处开始播放
- InnerAudioContext.stop() 停止, 再播放会从头开始
- InnerAudioContext.seek(number postion) 跳转到指定位置
  - 参数 number position 跳转的时间. 单位s, 精确到小数点后3位, 即支持 ms级别精度
- InnerAudioContext.destroy() 销毁当前实例

##### wx.createAudioContext(id, this)

创建 audio 上下文 AudioContext 对象

- id <audio> 组件的 id

###### 返回值 AudioContext

- AudioContext.setSrc(string src) 设置音频地址
- AudioContext.play() 播放音频
- AudioContext.pause() 音频暂停
- AudioContext.seek(number position) 音频跳转到指定位置, 单位s

### 背景音频

##### wx.onBackgroundAudioStop(callback) 

监听音乐停止事件

##### wx.onBackgroundAudioPause(callback)

监听音乐暂停事件

##### wx.onBackgroundAudioPlay(callback)

监听音乐播放事件

##### wx.stopBackgroundAudio(Object object)

停止播放音乐

- access 成功回调
- ...

示例 wx.stopBackgroundAudio()

##### wx.seekBackgroundAudio(Object object)

控制音乐播放进度

- position 音乐位置 单位 s
- success 成功回调
- ...

实例 wx.seekBackgroundAudio({  position: 30})

##### wx.pauseBackgroundAudio(Object object)

暂停播放音乐

- success 成功回调
- ...

##### wx.playBackgroundAudio(Object object)

使用后台播发器播放音乐. 对于微信客户端来说, 只能同时有一个后台音乐在播放. 当用户离开小程序后, 音乐将停止播放; 当用户在其他小程序占用了音乐播放器, 原有的小程序内的音乐将停止播放

- dataUrl 音乐链接(支持m4a, aac, mp3, wav)
- title 音乐标题
- coverImgUrl 封面URL
- success 成功回调
- ...

```js
wx.playBackgroundAudio({
    dataUrl: '',
    title: '',
    coverImgUrl: ''
})
```

##### wx.getBackgroundAudioPlayerState(Object object)

获取后台音乐播放状态

- success 接口调用成功回调
  - res.duration 选定音频长度(s), 只有在音乐播放中时返回
  - res.currentPosition 选定音频的播放位置(s)
  - res.status 播放状态
    - 0 暂停中
    - 1 播放中
    - 2 没有音乐播放
  - res.downloadPercent 音频下载进度百分比
  - res.dataUrl 歌曲数据链接
- ...

##### wx.getBackgroundAudioManager()

获取 全局唯一 的背景眼音频管理器, 小程序切入后台, 如果音频处于播放状态, 可以继续播放, 但是后台状态不能通过调用 api 操作音频的播放状态

微信客户端 6.7.2 开始, 如果需要在小程序后台继续播放音频, 需要在 app.json 中配置 requiredBackgroundModes 属性, 正式版需要通过审核

###### 返回值

BackgroundAudioManager

- BackgroundAudioManager.play() 播放音乐
- BackgroundAudioManager.pause() 暂停播放
- BackgroundAudioManager.seek() 跳转到指定位置
- BackgroundAudioManager.stop() 停止音乐
- BackgroundAudioManager.onCanplay() 监听背景音频进入可播放状态事件, 不保证后面可流畅播放
- BackgroundAudioManager.onWaiting() 监听音频加载中事件, 当音频因为数据不足, 需要停下来加载时会触发
- BackgroundAudioManager.onError() 监听背景音频播放错误事件
- BackgroundAudioManager.onPlay() 监听背景音频播放事件
- BackgroundAudioManager.onPause() 监听背景音频暂停事件
- BackgroundAudioManager.onTimeUpdate() 监听背景音频播放进度更新事件
- BackgroundAudioManager.onStop() 监听背景音频停止事件
- BackgroundAudioManager.onNext() 监听用户在系统音乐面板点击下一曲事件(IOS)
- BackgroundAudioManager.onPrev() 监听用户在系统音乐面板点击上一曲事件(IOS)

### 实时音视频

##### wx.createLivePusherContext()

创建 live-pusher 上下文 LivePusherContext 对象

###### 返回值 LivePusherContext

LivePusherContext实例, 可通过 wx.createLivePusherContext 获取

livePusherContext 与页面内唯一的 <live-pusher> 组件绑定, 操作对应的  <live-pusher> 组件

- LivePusherContext.start() 播放推流
- LivePusherContext.stop() 停止推流
- LivePusherContext.pause() 暂停推流
- LivePusherContext.resume() 回复推流
- LivePusherContext.switchCamera() 切换前后摄像头
- LivePusherContext.snapshot() 快照
- LivePusherContext.toggleTorh() 切换
- LivePusherContext.playBUG(object object) 播放背景音乐
- LivePusherContext.stopBGM() 停止背景音
- LivePusherContext.pauseBUG() 暂停背景音
- LivePusherContext.resumeBUG() 回复背景音
- LivePusherContext.setBUGMVolume(Object object) 设置背景音量

##### wx.createLivePlayerContext(id, this)

创建 live-player 上下文 LivePlayerContext 对象

- id <live-player> 组件 id 
- this 自定义组件下当前组件实例的 this, 以操作<live-player>组件

###### 返回值 LivePlayerContext

- LivePlayerContext.play(Object object) 播放
  - success 成功回调
  - ...
- LivePlayerContext.stop(Object object) 停止
  - success 成功回调
  - ...

- LivePlayerContext.mute(Object object) 静音
  - success 成功回调
  - ...
- LivePlayerContext.pause(Object object) 暂停推流
  - success 成功回调
  - ...
- LivePlayerContext.resume(Object object) 恢复
  - success 成功回调
  - ...
- LivePlayerContext.requestFullScreen(Object object) 进入全屏
  - 参数属性
    - direction 设置全屏时的方向, 默认 0
      - 0 正常横向
      - 90 屏幕逆时针90度
      - -90 屏幕顺时针90度
    - success 成功回调

LivePlayerContext.exitFullScreen(Object object) 退出全屏

- success 成功回调
- ...

### 录音

##### wx.stopRecord()

停止录音

##### wx.startRecord(Object object)

开始录音, 当主动调用 wx.stopRecord, 或者录音超过1分钟时自动结束录音. 当离开小程序时, 此接口无法调用

- success 成功回调

  参数 res.tempFilePath 录音文件的临时路径

- ..

示例

```js
wx.startRecord({
    success(res) {
        const tempFilePath = res.tempFilePath
        }
})
setTimeout(function () {
    wx.stopRecord() // 结束录音
}, 10000)
```

##### wx.getRecorderManager()

获取全局唯一的录音管理器 RecorderManager

###### 返回值 RecorderManager

- RecorderManager.start(Object object) 开始录音
  - duration  默认60000, 录音时长, 单位 ms, 最大值600000ms
  - sampleRate 采样率, 默认 8000
  - numberOfChannels 默认2 录音通道数
  - encodeBitRate 默认48000 编码码率
  - format 默认aac 音频格式
    - mp3
    - aac
  - frameSize 指定帧大小
  - audioSource 指定录音的音频输入源, 可通过 wx.getAvailableAudioSources() 获取当前音频源

- RecorderManager.pause() 暂停录音
- RecorderManager.resume() 继续录音
- RecorderManager.stop() 停止录音
- RecorderManager.onStart(callback) 监听录音开始事件
- RecorderManager.onResume(callback) 监听录音继续事件
- RecorderManager.onPause(callback) 监听录音暂停事件
- RecorderManager.onStop(callback) 监听录音结束事件
  - 回调函数参数属性 res.tempFilePath 录音文件的临时路径
- RecorderManager.onFrameRecorded(callback) 监听已录制完指定帧大小的文件事件. 如果设置了 frameSize, 则会回调此事件
  - 回调函数参数属性
    - frameBuffer  录音分片数据
    - isLastFrame 当前帧是否正常录音前的最后一帧
- RecorderManager.onError(callback) 监听录音错误事
  - 回调参数res.errMsg 错误信息
- RecorderManager.onInterruptionBegin(callback) 监听录音因为受到系统占用而被终端开始事件, 以下场景会触发此事件: 微信语音聊天, 微信视频聊天, 此事件触发后, 录音会被暂停, pause 事件于此事件后触发
- RecorderManager.onInterruptionEnd(callback) 监听录音中断结束事件. 受到 interruptionBegin 事件之后, 小程序内所有录音都会暂停, 收到此事件之后才可再次录音成功.

示例代码

```js
const recorderManager = wx.getRecorderManager()

recorderManager.onStart(() => {
  console.log('recorder start')
})
recorderManager.onPause(() => {
  console.log('recorder pause')
})
recorderManager.onStop((res) => {
  console.log('recorder stop', res)
  const {tempFilePath} = res
})
recorderManager.onFrameRecorded((res) => {
  const {frameBuffer} = res
  console.log('frameBuffer.byteLength', frameBuffer.byteLength)
})

const options = {
  duration: 10000,
  sampleRate: 44100,
  numberOfChannels: 1,
  encodeBitRate: 192000,
  format: 'aac',
  frameSize: 50
}

recorderManager.start(options)
```

### 相机

##### wx.createCameraContext()

创建 camera 上下文 CameraContext 对象

###### 返回值 CameraContext

cameraContext 与页面内唯一的 <camera> 组件绑定, 操作对应的 <camera> 组件.

方法

- CameraContext.takePhoto(Object object) 拍摄照片
  - quality 成像质量 string
    - high 高质量
    - normal 普通质量
    - low 低质量
  - success 成功回调
    - 回调参数 res.tempImagePath 照片文件临时路径
  - ...
- CameraContext.startRecord(Object object) 开始录像
  - timeoutCallback(callback) 超过30s或页面 onHide 时会结束录像
    - 回调参数 res
      - tempThumbPath  封面照片文件的临时路径
      - tempVideoPath 视频的文件的临时路径
  - success 成功回调
  - ...
- CameraContext.stopRecord(Object object) 结束录像
  - success 成功回调
    - 参数 res
      - 属性 tempThumbPath 分秒图片文件的临时路径
      - 属性 tempVideoPath 视频的文件的临时路径

### 字体

##### wx.loadFontFace(Object object)

动态加载网络字体. 文件地址需为下载类型

注意:

1. 引入中文字体，体积过大时会发生错误，建议抽离出部分中文，减少体积，或者用图片替代
2. 字体链接必须是https（ios不支持http)
3. 字体链接必须是同源下的，或开启了cors支持，小程序的域名是`servicewechat.com`
4. canvas等原生组件不支持使用接口添加的字体
5. 工具里提示 Faild to load font可以忽略

- family 定义的字体名称
- source 字体资源的地址, 建议格式为 TTF 和 WOFF
- desc  object可选字体描述符
  - style	字体样式(normal/italic/oblique)
  - weight    字体粗细(normal/bold/100-900)
  - variant  设置小写大写字母的字体显示文本
- success 调用成功回调
- ...

## 位置

##### wx.openLocation(Object object)

使用微信内置地图查看位置

 参数

- latitude 纬度 -90~90, 负表示南纬 使用 gcj02国测坐标系
- longitude 纬度 -180~180 负表示西经
- scale 缩放比例 5~18
- name 位置名
- address 地址的详细说明
- success 成功回调
- ...

##### wx.getLocation(Object object)

调用需要用户授权 scope.userLocation

获取当前的地理位置, 速度. 当用户离开小程序后, 此接口无法调用

参数

- type string 默认wgs84, wgs84返回 gps 坐标, gcj02 返回可用于 wx.openLocation 的坐标
- altitude 传入true会返回高度信息, 由于获取高度需要较高精度, 会减慢接口返回速度
- success 成功回调
  - 回调参数 res
    - latitude 纬度
    - longitude 精度
    - speed 速度 m/s
    - accuracy 位置的精确度
- ...

示例

```js
wx.getLocation({
    type: 'gcj02', // 返回可以用于wx.openLocation的经纬度
    success(res) {
        const latitude = res.latitude
        const longitude = res.longitude
        wx.openLocation({
            latitude,
            longitude,
            scale: 18
        })
    }
})
```

##### wx.chooseLocation(Object object)

打开地图选择位置. 调用前需要用户授权 scope.userLocation

参数

- success 接口调用成功回调
  - 回调参数 res
    - name 位置名称
    - address 详细地址
    - latitude 纬度
    - longitude 经度
- ...

```js
wx.chooseLocation({
    success(res) {
        console.log(res)
    }
})
```

## 转发

##### wx.showShareMenu(Object object)

显示当前页面转发按钮

- withShareTicket 是否使用 shareTicket 的转发详情
- success 成功回调
- ...

##### wx.hideShareMenu(Object object)

隐藏转发按钮

- success 成功回调
- ....

##### wx.getShareInfo(Object object)

获取转发详细信息

- shareTicket  string 必填 shareTicket
- timeout 超时时间
- success 成功回调
  - 参数 res 
    - errMsg 错误信息
    - encryptedData 包括敏感数据在内的完整转发信息的加密数据
    - iv 加密算法初始向量
- ...

##### wx.updateShareMenu(Object object)

更新转发属性

- withShareTicket 是否使用带 shareTicket 的转发详情
- isUpdatableMessage  是否是动态消息
- activityId 动态消息的 activityId, 通过 createActivityId 接口获取
- templateInfo 动态消息的模板信息
  - parameterList 参数列表
    - name 参数名
    - value 参数值
- success 成功回调
- ...

## 文件

##### wx.getFileSystemManager()

获取全局唯一的文件管理器

###### 返回值 FileSystemManger

- FileSystemManager.access(Object object) 判断文件/目录是否存在

  - path 文件路径
  - success 成功回调
    - res.errMsg 错误信息 fail no such file or directory ${path}
  - ...

  FileSystemManager.accessSync(path)  同步版本

- FileSystemManager.appendFile(Object object) 在文件结尾追加内容

  - filePath 追加内容的文件路径

  - data  要追加的文本或二进制数据流(string/ArrayBuffer)

  - encoding 指定写如文件的字符编码, 默认 utf8

    - 合法值: ASCII base64 binary hex  ucs2/ucs-2/utf16le/utf-16le  utf-8/utf8  latin1

  - success 成功回调

  - fail 失败回调

    - res.errMsg 错误信息

    | fail no such file or directory, open ${filePath}          | 指定的 filePath 文件不存在           |
    | --------------------------------------------------------- | ------------------------------------ |
    | fail illegal operation on a directory, open "${filePath}" | 指定的 filePath 是一个已经存在的目录 |
    | fail permission denied, open ${dirPath}                   | 指定的 filePath 路径没有写权限       |
    | fail sdcard not mounted                                   | 指定的 filePath 是一个已经存在的目录 |

    FileSystemManager.appendFileSync(filePath, data, encoding) 同步版本

- FileSystemManager.saveFile(Object object) 保存临时文件到本地. 会移动临时文件, 调用成功后, tempFilePath不可用

  - tempFilePath 临时文件路径

  - filePath 要存储的文件路径

  - success 成功回调

    - res.savedFilePath 存储后的文件路径

  - fail 失败回调

    - res.errMsg 错误信息

    | fail tempFilePath file not exist            | 指定的 tempFilePath 找不到文件 |
    | ------------------------------------------- | ------------------------------ |
    | fail permission denied, open "${filePath}"  | 指定的 filePath 路径没有写权限 |
    | fail no such file or directory "${dirPath}" | 上级目录不存在                 |

  - ...

    FileSystemManager.saveFileSync(tempFilePath, filePath) 同步版本

- FileSystemManager.getSavedFileList(Object object) 获取该小程序已保存的临时文件列表

  - success 成功回调
    - 回调参数 res.fileList 文件数组
  - ...

- FileSystemManager.removeSavedFile(Object object) 删除该小程序下已保存的本地缓存文件

  - filePath 需要删除的文件路径
  - success 成功回调
  - fail 失败回调
    - res.errMsg 合法值: fail file not exist 指定 tempFilePath 找不到文件
  - ...

- FileSystemManager.copyFile(Object object) 复制文件

  - srcPath 源文件路径, 只可以是普通文件

  - destPath 目标文件路径

  - success 成功回调

  - fail 失败回调

    - res.errMsg 错误信息

    | fail permission denied, copyFile {srcPath} -> ${destPath}  | 指定目标文件路径没有写权限                   |
    | ------------------------------------------------------------ | -------------------------------------------- |
    | fail no such file or directory, copyFile {srcPath} -> ${destPath} | 源文件不存在，或目标文件路径的上层目录不存在 |

  - ...

    copyFileSync(srcPath, destPath) 同步版本

- FileSystemManager.getFileInfo(Object object) 获取该小程序下的本地临时文件或本地缓存文件信息

  - filePath 读取的文件路径
  - success 成功回调

- FileSystemManager.mkdir(Object object) 创建目录

  - dirPath 创建的目录路径

  - success 成功回调

    mkdirSync(dirPath) 同步版本

- FileSystemManager.readFile(Object object) 读取本地文件内容

  - filePath 要读取的文件的路径

  - encoding 指定读取文件的字符集编码, 不传以 ArrayBuffer 格式读取文件的二进制内容

  - success 成功回调

    - res.data 文件内容(string/ArrayBuffer)

  - ... 

    readFileSync(filePath, encoding) 同步版本

- FileSystemManager.readdir(Object object) 读取目录内文件列表

  - dirPath 要读取的目录文件

  - success 成功回调

    - 回调参数 res.files 指定目录下的文件名数组

    FileSystemManager.readdirSync(dirPath) 同步版本, 返回值 files 文件名数组

- FileSystemManager.rename(Object object) 重命名文件, 可以把文件从 oldPath 移动到 newPath

  - oldPath 源文件路径, 可以是普通文件或目录

  - newPath 新文件路径

  - success 成功回调

  - ...

    FileSystemManager.renameSync(oldPath, newPath) 同步版本

- FileSystemManager.rmdir() 删除目录

  - dirPath 要删除的目录路径

  - recursive 是否递归删除目录, ture 则删除该目录和该目录下的所有子目录及文件, 默认 false

  - success 成功回调

    FileSystemManager.rmdirSync(disPath, recursive) 同步版本

- FileSystemManager.stat(Object object) 获取 Stats 对象

  - path 文件/目录 路径
  - recursive 是否递归获取目录下的每个文件的 Stats 信息
  - success 成功回调
    - 返回值res.stats 当 recursive 是 false 时, res.stats 是一个 States 对象, 反之为 Object , key 以 Path为根路径的相对路径, value 是 该路径对应的 Stats 对象
  - ...

- FileSystemManager.unlink(Object object) 删除文件

  - filePath 删除的文件路径

  - success 成功回调

  - ...

    FileSystemManager.unlinkSync(fIlePath) 同步版本 

- FileSystemManager.unzip(Object object) 解压文件

  - zipFilePath 源文件路径, 只可以使 zip 压缩文件
  - targetPath 目标目录路径
  - success 成功回调

- FileSystemManager.writeFile(Obejct object) 写文件

  - filePath  要写入的文件路径

  - data 写入的文本或二进制数据

  - encoding 指定写入文件的字符集编码(默认utf8)

  - success 成功回调

  - ...

    FileSystemManager.writeFileSync(filePath, data, encoding) 同步版本

###### Stats 

- Stats.isDirectory() 判断当前文件是否是一个目录
- Stats.isFile() 判断当前文件是否是一个普通文件

##### wx.getFileInfo(Obejct object)

获取文件信息

- filePath 本地文件路径
- digestAlgorithm  默认值 md5 计算文件摘要的算法
  - md5 算法
  - sha1 算法
- success 成功回调
  - size 文件大小, 单位字节
  - sigest 按照传入的 digestAlgorithm 计算得出的文件摘要
- ...

示例

```js
wx.getFileInfo({
    filePath: "/temp/t1.txt",
    digestAlgorithm: "sha1",
    success(res) {
        console.log(res.size)
        console.log(res.digest)
    }
})
```

##### wx.getSavedFileInfo(Object object)

获取本地文件的文件信息. 此接口只能用于获取已保存到本地的文件, 若需要获取临时文件信息, 使用 wx.getFileInfo()

- filePath 文件路径
- success 成功回调
  - 回调参数res
    - size  文件大小
    - createTime 文件保存时的时间戳, 从 1970/01/01 08:00:00 到该时刻的秒数
- ...

##### wx.getSavedFileList(Object object)

获取该小程序已保存的本地缓存文件列表

- success 成功回调
  - 参数 res.fileList 文件数组, 每一项是一个fileItem
    - filePath 文件路径
    - size 文件大小
    - createTime 创建时间戳

##### wx.removeSavedFile(Object object)

删除本地缓存文件

- filePath  需要删除的文件路径
- success 成功回调
- ...

##### wx.openDocument(Obejct object)

新开页面打开文档

- filePath 文件路径, 可通过 downloadFile 获取
- fileType 文件类型, 指定文件类型打开文件
  - 支持 doc docx xls xlsx ppt pptx pdf 等格式
- success 成功回调
- ...

示例

```js
wx.downloadFile({
    // 示例 url，并非真实存在
    url: 'http://example.com/somefile.pdf',
    success(res) {
        const filePath = res.tempFilePath
        wx.openDocument({
            filePath,
            success(res) {
                console.log('打开文档成功')
            }
        })
    }
})
```

##### wx.saveFile(Object object)

保存文件到本地. 注意的是 saveFile 会把临时文件移动. 所以调用成功后传入的临时文件路径将不可用

- tempFilePath  需要保存的文件的临时路径
- success 成功回调
  - 返回值 res.savedFilePath 存储后的文件路径  
- ...

示例

```js
wx.chooseImage({
    success(res) {
        const tempFilePaths = res.tempFilePaths
        wx.saveFile({
            tempFilePath: tempFilePaths[0],
            success(res) {
                const savedFilePath = res.savedFilePath
                }
        })
    }
})
```

## 开放接口

### 登录

##### wx.login(Object object)

调用接口获取登录凭证(code). 通过凭证进而换区用户登录状态信息, 包括用户的唯一标识(openid) 及本次登陆的会话密匙(session_key) 等. 用户数据的加解密通讯需要依赖会话密匙完成

- timeout 超时时间, 单位 ms
- success 调用成功的回调函数
  - 回调参数 res.code 用户登录凭证, 有效期五分钟, 开发者需要在开发者服务器厚爱调用 code2Session, 使用 code 换取 openid 和 session_key 等信息
- fail 调用失败回调
- ...

##### code2Session

登录凭证校验, 通过 wx.login() 接口获得临时登录凭证 code 后传到开发者服务器调用此接口完成登录流程. 本接口应在后台服务器调用

请求地址 `GET https://api.weixin.qq.com/sns/jscode2session?appid=APPID&secret=SECRET&js_code=JSCODE&grant_type=authorization_code`

- appid 小程序 appid
- secret 小程序 appSecret
- js_code 登录时获取的 code
- grant_type 授权类型, 此处只需要填写 authorization_code

###### 返回值 Object

返回的 JSON 数据包

- oppid 用户唯一标识
- session_key 会话密匙
- unionid 用户在开放平台的唯一标识, 在满足 UnionID 下发条件的情况会返回
- errcode 错误码
  - -1 系统繁忙, 开发者稍后再试
  - 0 请求成功
  - 40029 code 无效
  - 45011 频率限制, 每个用户每分钟100次
- errmsg 错误信息

##### wx.checkSession(Object object) 检查登录状态是否过期

通过 wx.login 接口获得的用户登录行状态拥有一定的时效性. 用户越久未登录小程序, 用户登录状态越有可能失效. 反之, 如果用户一直在使用小程序, 则用户登录状态一直保持有效. 具体时效逻辑由微信维护. 我们只要调用 wx.checkSession 接口检测当前用户登录状态是否有效.

登录状态过期后开发者可以再调用 wx.login 获取新的用户登录状态. 调用成功说明当前 session_key 未过期, 调用失败说明 session_key 已经过期.

- success 成功回调
- fail 失败的回调

```js
wx.checkSession({
    success() {
        // session_key 未过期，并且在本生命周期一直有效
    },
    fail() {
        // session_key 已经失效，需要重新执行登录流程
        wx.login() // 重新登录
    }
})
```

### 小程序跳转

##### wx.navigateToMiniProgram(Object object) 

打开另外一个小程序

- appId 要打开的小程序 appId
- path  打开的页面路径, 空表示打开首页
- extraData 需要传递个目标小程序的数据, 目标小程序可以再 App.onLaunch, App.onShow 中获取到该数据
- envVersion 默认值 release(正式版) 要打开的小程序版本, 仅在当前小程序为开发版或测试版时该参数有效, 如果当前小程序时是正版, 则打开的小程序必须是正版
- success 成功回调
- ...

使用限制: 需要用户触发跳转, 需要用户确认跳转, 每个小程序可跳转的其他小程序数量限制为不超过10 个

```js
wx.navigateToMiniProgram({
    appId: '',
    path: 'page/index/index?id=123',
    extraData: {
        foo: 'bar'
    },
    envVersion: 'develop',
    success(res) {
        // 打开成功
    }
})
```

##### wx.navigateBackMiniProgram(Object object)

返回到上一个小程序, 只有在当前小程序是被其他小程序打开时可以调用成功

- extraData 需要返回给上一个小程序的数据, 可在 App.onShow 中获取到这份数据
- success 成功回调
- ...

### 账号信息

##### wx.getAccountInfoSync()

获取当前账号信息

返回值 Object

- miniProgress 小程序账号信息
  - appId 小程序 appId
- plugin 插件账号信息

  - appId 插件 id
  - version 插件版本号

### 用户信息

##### wx.getUserInfo(Object object)

调用前需要 用户授权 scope.userInfo

获取用户信息

- withCredentials 是否带上登录信息, 默认 false, 如果为true, 要求此前有吊用过 wx.login 且登录状态未过期, 此时返回的数据会包含 encryptedData, iv等敏感信息; 为 false时, 不要求有登录登录状态

- lang 显示用户信息的语言 默认 en

  - en / zh_CN / zh_TW

- success 成功回调

  - userInfo 用户信息对象, 不包含 openId 等敏感信息
  - rawData 不包含敏感信息的恩怨史数据字符串, 用于计算签名
  - signature 使用 sha1 (rawData+sessionkey) 得到字符串, 用于校验用户信息
  - encryptedData 包括敏感数据在内的完整用户信息的加密数据
  - iv 加密算法的初始向量

  接口调整说明: 在用户未授权的情况下调用此接口, 将不再出现授权弹窗, 会直接进入 fail 回调, 在用户已授权的情况下调用此接口, 可成功获取用户信息.

示例:

```js
//	必须在用户已授权的情况下调用
wx.getUserInfo({
  success(res) {
    const userInfo = res.userInfo
    const nickName = userInfo.nickName
    const avatarUrl = userInfo.avatarUrl
    const gender = userInfo.gender // 性别 0：未知、1：男、2：女
    const province = userInfo.province
    const city = userInfo.city
    const country = userInfo.country
  }
})
```

encryptedData 解密后为以下json结构

```json
{
  "openId": "OPENID",
  "nickName": "NICKNAME",
  "gender": GENDER,
  "city": "CITY",
  "province": "PROVINCE",
  "country": "COUNTRY",
  "avatarUrl": "AVATARURL",
  "unionId": "UNIONID",
  "watermark": {
    "appid": "APPID",
    "timestamp": TIMESTAMP
  }
}
```

示例代码: 如果只是展示用户头像昵称, 可以使用 <open-data /> 组件

```html
<!-- 如果只是展示用户头像和昵称, 可以使用 <open-data /> 组件 -->
<open-data type="userAvatarUrl"></open-data>
<open-data type="userNickName"></open-data>

<!-- 需要使用 button 来授权登录 -->
<button 
        wx:if="{{canIUse}}"
        open-type="getUserInfo"
        bindgetuserinfo="bindGetUserInfo"
        >授权登录</button>
<wiew wx:else>请升级微信版本</wiew>
```

```js
Page({
    data: {
        canIUse: wx.canIUse('button.open-type.getUserInfo')
    },
    onLoad() {
        // 查看是否授权
        wx.getSetting({
            success(res) {
                if (res.authSetting['scope.userInfo']) {
                    // 已经授权，可以直接调用 getUserInfo 获取头像昵称
                    wx.getUserInfo({
                        success(res) {
                            console.log(res.userInfo)
                        }
                    })
                }
            }
        })
    },
    bindGetUserInfo(e) {
        console.log(e.detail.userInfo)
    }
})
```

##### getPaidUnionId 

本接口应在后端服务器调用

用户支付完成后, 获取该用户的 UnionId, 无需用户验证

注意: 调用前需要用户完成支付, 且在支付后的五分钟内有效

请求地址: `GET https://api.weixin.qq.com/wxa/getpaidunionid?access_token=ACCESS_TOKEN&openid=OPENID`

请求参数: 

- access_token 接口调用凭证
- openid 支付用户唯一标识
- transaction_id 微信支付订单号
- mch_id 微信支付分配的珊瑚好, 和商户订单号配合使用
- out_trade_no 微信支付商户订单号, 和商户号配合使用

###### 返回值 Object

返回的 JSON 数据包

unionid 用户唯一标识, 调用成功后返回

errcode 错误码

ermsg 错误信息 

​	-1 系统繁忙 0 请求成功 40003 openid错误 89002 没有绑定开发平台账号 89300 订单无效

使用说明: 

 1. 微信支付订单号 (transaction_id)

    ```
    https://api.weixin.qq.com/wxa/getpaidunionid?access_token=ACCESS_TOKEN&openid=OPENID&transaction_id=TRANSACTION_ID
    ```

	2. 微信支付商户订单号和微信支付商户号(out_trade_no 及 mch_id)

    ```
    https://api.weixin.qq.com/wxa/getpaidunionid?access_token=ACCESS_TOKEN&openid=OPENID&mch_id=MCH_ID&out_trade_no=OUT_TRADE_NO
    ```

##### UserInfo 

用户信息

属性 

​	string nickName 用户昵称

 	string avatarUrl 用户头像图片的 URL, URL 最后一个数值代表正方形头像大小, 用户没有头像时,此项为空, 如果用户更换头像, 原有头像 URL 将失效

​	number gender 用户性别  0未知 1男性 2女性

​	string country 用户所在国家

​	string province 用户所在省份

​	string city 用户所在城市

​	string language 显示国家省份城市所用的语言

### 接口调用凭证

##### getAccessToken

本接口应在后端服务器调用

获取小程序全局唯一后台接口调用凭据 (access_token). 调用各后台接口都需要使用 access_token, 开发者需要进行妥善保存. 请求地址方式如下

```
GET https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=APPID&secret=APPSECRET
```

请求参数说明

​	grant_type 填写 client_credential

​	appid 小程序唯一凭证, 即 AppID 需要已成为开发者, 且账号没有异常状态

​	secret 小程序唯一凭证密匙, 及 AppSecret, 获取方式同 appid

###### 返回值 JSON 数据包

​	access_token 获取到的凭证

​	expire_in 凭证有效期, 单位 s, 目前是 两小时以内

​	errcode 错误码 合法值 

​		-1 系统繁忙  

​		0 请求成功 

​		40001 AppSecret错误或者 AppSecret 不属于该小程序

​		40002 确保 grant_type 字段值为 client_credential

​		40013 不合法的 AppID

​	errmsg 错误信息

返回数据示例

正确 : {"access_token": "ACCESS_TOKEN", "expires_in": 7200}

错误: {"errcode": 40013, "errmsg": "invalid appid"}

###### access_token 的存储和更新

- access_token 的存储至少需要保留 512 个字符空间
- access_token 的有效期目前为 2小时, 需要定时刷新, 重复获取将导致上次获取 access_token 失效
- 建议开发者使用中控服务器统一获取和刷新 access_token, 其它业务逻辑服务器所使用的 access_token 均来自该中控服务器.
- access_token 的有效期通过返回值 expire_in 来传达, 中控服务器需要依据该有效期提前刷新, 建议提前5分钟
- access_token 有效期可能在未来会有调整, 所以中控服务器不仅要内部主动定时刷新, 还需要提供被刷新 access_token 的接口, 这样便于业务服务器在调用 API 调用数值 access_token 已超时情况下, 触发 access_token 的刷新流程.

### 数据上报

##### wx.reportMonitor(string name, number value)

自定义业务数据监控上报接口

- name 监控ID, 在 [小程序管理后台] 新建数据指标后获得
- value 上报数值, 经处理后会在 [小程序管理后台] 上展示每分钟的上报总量

使用说明: 使用前, 需要在 [小程序管理后台-运维中心-性能检测-业务数据监控] 中新建监控事件, 配置监控描述与告警类型, 每一个监控事件对应唯一的监控 ID, 开发者最多可以创建 128 个监控事件

示例: `wx.reportMonitor('1', 1)`

### 数据分析

#### wx.reportAnalyTics(string eventName, Object data)

自定义分析数据上报接口. 使用前, 需要在小程序管理吼他自定义分析中新建事件, 配置好事件名与字段

- eventName 事件名
- data 上报的自定义数据
  - key 配置中的字段名
  - value 上报的数据

示例代码

```js
wx.reportAnalytics('purchase', {
    price: 120,
    color: 'red'
})
```

#### 访问留存

##### getAnalysisDailyRetain

本接口应在后端服务器调用

获取用户访问小程序日留存

请求地址: 

```
POST https://api.weixin.qq.com/datacube/getweanalysisappiddailyretaininfo?access_token=ACCESS_TOKEN
```

请求参数

​	access_token 接口调用凭证

​	begin_date 开始日期. 格式yyyymmdd

​	end_date 结束日期, 限定查询1条数据, 允许设置的最大值为昨天. 格式 yyyymmdd

###### 返回值 Object

​	ref_date 日期

​	visit_uv_new 新增用户留存

​		key 标识 0开始, 表示当天, 1表示1天后, 以此类推

​		value key对应日期的新增用户数/活跃用户数

​	visit_uv 活跃用户留存. 值同上

请求数据示例		

```json
{
    "begin_date": "20170313",
    "end_date": "20170313"
}
```

返回数据示例

```json
{
    "ref_date": "20170313",
    "visit_uv_new": [
        {
            "key": 0,
            "value": 5464
        }
    ],
    "visit_uv": [
        {
            "key": 0,
            "value": 55500
        }
    ]
}
```

##### getAnalysisMonthlyRetain

本接口应在后端服务器调用

获取用户访问小程序月留存

请求地址

```
POST https://api.weixin.qq.com/datacube/getweanalysisappidmonthlyretaininfo?access_token=ACCESS_TOKEN
```

参数及返回值同上一致

##### getAnalysisWeeklyRetain

本接口应在后端服务器调用

获得用户访问小程序周留存

请求地址

```
POST https://api.weixin.qq.com/datacube/getweanalysisappidweeklyretaininfo?access_token=ACCESS_TOKEN
```

参数返回值与上一致

#### getAnalysisDailySummary

本接口应在后端服务器调用

获取用户访问小程序服务器调用

请求地址

```
POST https://api.weixin.qq.com/datacube/getweanalysisappiddailysummarytrend?access_token=ACCESS_TOKEN
```

请求参数与上一致

###### 返回值 Object 

- ref_date 日期格式 yyyymmdd
- list  数据列表
  - index 分布类型
    - access_source_session_cnt 访问来源分布
    - access_staytime_info 访问时长分布
    - access_depth_info  访问深度的分布
  - item_list 分布数据列表
    - key 场景 id
    - value 该场景 id 访问 pv
    - access_source_visit_uv 该场景范围 uv

#### getAnalysisVisitPagefa

本接口应在后端服务器调用

访问页面, 目前只提供按 page_visit_pv 排序的  top200

```
POST https://api.weixin.qq.com/datacube/getweanalysisappidvisitpage?access_token=ACCESS_TOKEN
```

### 支付

##### wx.requestPayment(Object object)

发起微信支付 [微信支付接口文档](https://pay.weixin.qq.com/wiki/doc/api/wxa/wxa_api.php?chapter=1_1)

- timeStamp 当前时间戳

- nonceStr 随机字符串, 长度32字符以下

- package 统一下单接口返回的 prepay_id 参数值, 提交格式如: prepay_id = ***
- signType 签名算法, 默认 MD5
  - MD5 / HMAC-SHA256
- paySign 前面, 具体前面方案键 小程序接口文档
- success 成功回调
- ...

示例代码

```js
wx.requestPayment({
    timeStamp: '',
    nonceStr: '',
    package: '',
    signType: 'MD5',
    paySign: '',
    success(res) { },
    fail(res) { }
})
```

### 授权

##### wx.authorize(Object object)

提前当用户发起授权请求. 调用后会立即弹窗询问用户是否同意授权小程序使用某项功能或获取用户某些数据, 但不会实际调用对应接口, 如果用户之前以及同意授权, 则不出现弹窗, 直接返回成功 [用户授权](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html)

- scope  需要获取权限的 scope [scope列表](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/authorize.html)
- success 成功回调
- ...

注意：wx.authorize({scope: "scope.userInfo"})，无法弹出授权窗口，请使用 <button open-type="getUserInfo"/>

示例代码

```js
// 可以通过 wx.getSetting 先查询一下用户是否授权了 "scope.record" 这个 scope
wx.getSetting({
    success(res) {
        if (!res.authSetting['scope.record']) {
            wx.authorize({
                scope: 'scope.record',
                success() {
                    // 用户已经同意小程序使用录音功能，后续调用 wx.startRecord 接口不会弹窗询问
                    wx.startRecord()
                }
            })
        }
    }
})
```

### 设置

##### wx.openSetting(Objedct object)

调起客户端小程序设置界面, 返回用户设置的操作结果. 设置界面只会出现小程序已经向用户请求过的权限

注意: 2.3.0 版本开始, 用户发生点击行为后, 才可以跳转打开设置页, 管理授权信息

- success 成功回调
  - authSetting 用户授权结果
- ...

```js
wx.openSetting({
    success(res) {
        console.log(res.authSetting)
        // res.authSetting = {
        //   "scope.userInfo": true,
        //   "scope.userLocation": true
        // }
    }
})
```

##### wx.getSetting(Object object)

获取用户的当前设置, 返回值中只会出现小程序向用户请求过的权限

- success 成功回调
  - res.authSetting 用户授权结果
- ...

```js
wx.getSetting({
    success(res) {
        console.log(res.authSetting)
        // res.authSetting = {
        //   "scope.userInfo": true,
        //   "scope.userLocation": true
        // }
    }
})
```

##### AuthSetting

用户授权设置信息

- scope.userInfo 是否授权用户信息, 对应接口 wx.getUserInfo
- scope.userLocation 是否授权地理位置, 对应接口 wx.getLocation, wx.chooseLoaction
- scope.address 是否授权通讯地址, 对应接口 wx.chooseAddress
- scope.invoiceTitle 是否授权获取发票, 对应接口 wx.chooseInvoice
- scope.werun 是否授权微信运动步数, 对应接口 wx.getWeRunData
- scope.record 是否授权录音功能, 对应接口 wx.startRecord
- scope.writePhotosAlbum 是否授权保存到相册  wx.saveImageToPhotosAlbum, wx.saveVideoToPhotosAlbum
- scope.camera 是否授权摄像头, 对应 <camera /> 组件

### 客服消息

##### customerTyping 

本接口应在后端服务器调用

下发客服当前输入状态给用户

请求地址及方式

```
POST https://api.weixin.qq.com/cgi-bin/message/custom/typing?access_token=ACCESS_TOKEN
```

参数

- access_token 接口调用凭证
- touser 用户的 OpenID
- command命令
  - Typing 对用户发"正在输入"状态
  - CancelTyping 取消度用户的 "正在输入"状态

返回的 JSON 数据包

- errcode 错误码
  - 45072 command 字段取值不对
  - 45080 下发输入状态, 需要之前30s内核用户有过消息交互
  - 45081 已经在输入状态, 补课重复下发
- errmsg 错误信息

请求数据示例

```
{
	"touser": "OPENID",
	"command": "Typing"
}
```

##### getTempMedia 

获取客服消息内的临时素材, 

```
GET https://api.weixin.qq.com/cgi-bin/media/get?access_token=ACCESS_TOKEN&media_id=MEDIA_ID
```

##### sendCustomerMessage

发送客服消息给用户

```
POST https://api.weixin.qq.com/cgi-bin/message/custom/send?access_token=ACCESS_TOKEN
```

##### uploadTempMedia

把媒体文件上传到微信服务器.目前仅支持图片, 用于发送客服消息或被动回复用户消息

### 模板消息

### 统一服务消息

### 动态消息

### 插件管理

### 收货地址

##### wx.chooseAddress

调用前需要用户授权

获取用户收货地址, 调起用户编辑收货地址原生界面, 并在编辑完成后返回用户选择的地址.

- success 成功回调
  - 回调参数 res 下的属性
    - userName 收货人姓名
    - postalCode 右边
    - provinceName 国标收货地址第一级地址
    - cityName 
    - countyName
    - detailInfo 详细收货地址信息
    - nationalCode 收货地址国家码
    - telNumber 收货人手机号码
    - errMsg 错误信息
- ...

示例

```js
wx.chooseAddress({
    success(res) {
        console.log(res.userName)
        console.log(res.postalCode)
        console.log(res.provinceName)
        console.log(res.cityName)
        console.log(res.countyName)
        console.log(res.detailInfo)
        console.log(res.nationalCode)
        console.log(res.telNumber)
    }
})
```

### 卡卷

### 发票

# mpvue

## 开始

**介绍**

1. 基于 vue.js 封装的用于开发小程序的框架

2. 融合原生小程序和 vue.js 的特点

3. 完全组件化

**特点**

1. 组件化开发
2. 完成的 vue.js 开发体验
3. 可使用 vuex 管理转台
4. webpack 构建项目
5. 最终 h5 转换工具将项目表编译成小程序识别的文件

### 初始化项目

1. npm install vue-cli -g 下载vue脚手架
2. vue init mpvue/mpvue-quickstart my-pro 初始化项目
3. cd my-pro 进入项目根目录
4. npm install 根据package.json 安装项目依赖
5. npm run dev / npm start 启动初始化项目



### 开启项目

npm run dev 后, 打开微信开发者工具, 对项目进程进行查看

## 基础

**事件绑定**

​	@tap = '事件名' 冒泡事件

​	@tap.stop = '事件名' 非冒泡事件



**注意事项: **

​	除了可以使用 vue 本身的生命周期外, mpvue 还兼容了小程序的生命周期, 这部分生命周期钩子来源于**微信小程序的 Page**, 除特殊情况外, 不建议使用小程序的生命周期钩子.

## flyio 使用(我这没用)

**axios 不支持微信小程序, 底层使用 window 对象的  HttpRequest 实现**

在小程序的开发, 我们选择使用 flyio 来实现数据的请求

**下载** 

​	**`npm install flyio -S`**	

**准备**

```js
//	引入
import Fly from 'flyio/dist/npm/wx'
//	实例化fly并挂载到全局 Vue 上
Vue.prototype.$fly = new Fly();
```

**基本使用**

```js
const urlLink = 'http://t.yushu.im/v2/movie/top250';
this.$fly.get(urlLink)
    .then((res)=>{
    	console.log(res);
	})
    .catch((err)=>{
    	console.log(err);
	})
```



## 生命周期



## Vuex 数据管理

![1543909065239](.\wx\1543909065239.png)

我们按照图示, 建立一下目录

```
|-store
	|-index.js
	|-state.js
	|-actions.js
	|-mutation-types.js
	|-mutations.js
	|-getters.js
```

index.js 导出模块, 在app 的 main.js  里挂载 store 进行数据管理

![1543909410453](.\wx\1543909410453.png)

![1543909448924](.\wx\1543909448924.png)

基本实现流程: 

1. state 负责定义数据初始状态
2. actions 负责请求数据, 并执行 commit 触发指定 mutations 

3. mutations 负责对数据状态进行更新操作
4. 在需要数据的视图中分发 action 执行指定数据的获取

![1543910090632](.\wx\1543910090632.png)





## 踩坑之路

### 编译坑

#### 未找到 app.json 入口

- 问题描述: mpvue编译后在微信开发者工具中未找到 app.json入口

- 解决方案:

  修改mpvue生成的目录下的 project.config.json 文件, 添加 **"miniprogramRoot": "dist/wx/"**

![1543852366114](.\wx\1543852366114.png)

#### 未找到 xxx.wxml

- 问题描述: 我们新建一个组件, 未找到 xxx.wxml

- 解决方案:

  新建组件不会及时帮我们编译到dist中, 所以**每当我们新建一个组件的时候,  需要重新执行 npm run dev**

### 事件坑

#### wx.navigateTo()

- 问题描述: wx.navigateTo() 跳转失效

- 解决方案:

  **wx.navigateTo() 不能应用于跳转至tabBar上挂载的页面, 如果需要, 则请使用 wx.switchTab()**



